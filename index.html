<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–ò–≥—Ä–∞ –®–ø–∏–æ–Ω</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background-color: #f5f5f5;
      margin: 0;
      padding: 20px;
    }

    .screen {
      display: none;
    }

    .visible {
      display: block;
    }

    button {
      padding: 10px 20px;
      margin: 10px;
      font-size: 16px;
      cursor: pointer;
    }

    .card {
      font-size: 24px;
      margin: 30px 0;
    }

    input[type="text"],
    input[type="number"] {
      margin: 5px;
      padding: 5px;
      font-size: 14px;
      width: 200px;
    }

    .mode-button {
      margin: 5px;
      padding: 8px 16px;
      font-size: 14px;
      cursor: pointer;
      border: 2px solid #333;
      background-color: white;
    }

    .mode-button.active {
      background-color: #333;
      color: white;
    }

    #spyCountBlock {
      margin-top: 10px;
    }

    #allRoles {
      margin-top: 20px;
      font-size: 18px;
      display: flex;
      justify-content: center;
    }

    #allRoles .role-list {
      text-align: left;
      display: inline-block;
    }
  </style>
</head>
<body>
  <div id="startScreen" class="screen visible">
    <h1>–ò–≥—Ä–∞ "–®–ø–∏–æ–Ω"</h1>

    <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤:
      <input type="number" id="playerCount" min="3" max="20" value="6" oninput="renderNameInputs()" />
    </label>

    <h3>–†–µ–∂–∏–º —à–ø–∏–æ–Ω–æ–≤:</h3>
    <div>
      <button class="mode-button" onclick="setSpyMode('classic')">–ö–ª–∞—Å—Å–∏–∫–∞ (1 —à–ø–∏–æ–Ω)</button>
      <button class="mode-button" onclick="setSpyMode('random')">–°–ª—É—á–∞–π–Ω–æ</button>
      <button class="mode-button" onclick="setSpyMode('custom')">–í—ã–±–æ—Ä –≤—Ä—É—á–Ω—É—é</button>
    </div>

    <div id="spyCountBlock" style="display:none;">
      <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —à–ø–∏–æ–Ω–æ–≤:
        <input type="number" id="spyCount" min="1" value="1" />
      </label>
    </div>

    <div id="nameFields"></div>
    <button onclick="startGame()">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
  </div>

  <div id="cardScreen" class="screen">
    <h2><span id="currentPlayer"></span></h2>
    <button onclick="showCard()">–ü–æ–∫–∞–∑–∞—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É</button>
  </div>

  <div id="showCardScreen" class="screen">
    <div class="card" id="cardText">...</div>
    <button onclick="nextPlayer()">–Ø –ø–æ—Å–º–æ—Ç—Ä–µ–ª</button>
  </div>

  <div id="endScreen" class="screen">
    <h2>–í—Å–µ –∏–≥—Ä–æ–∫–∏ –ø–æ—Å–º–æ—Ç—Ä–µ–ª–∏ —Å–≤–æ–∏ –∫–∞—Ä—Ç–æ—á–∫–∏</h2>
    <p>–ú–æ–∂–µ—Ç–µ –Ω–∞—á–∏–Ω–∞—Ç—å –æ–±—Å—É–∂–¥–µ–Ω–∏–µ!</p>
    <button onclick="location.reload()">–°—ã–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
    <button onclick="showAllRoles()">–ü–æ–∫–∞–∑–∞—Ç—å —Ä–æ–ª–∏ –∏–≥—Ä–æ–∫–æ–≤</button>
    <div id="allRoles"></div>
  </div>

  <script>
    const locations = [
      "–õ–∞–±–∞ –≤–∫—É—Å–∞", "–•–∞—Ç–∞ –Ø—Ä–∏–∫–∞", "–ö–æ—Ä–≥–∏—à", "–î–∂–∞–æ –î–∞", "–¶–µ—Ä–∫–æ–≤—å",
      "–ü–æ–¥–∑–µ–ª–µ–Ω—å–µ", "–ö–∏–Ω–æ—Ç–µ–∞—Ç—Ä", "–®–∫–æ–ª–∞", "–ü–æ–µ–∑–¥", "–ê–ª–∫–æ–º–∞—Ä–∫–µ—Ç",
      "–ü–∞—Ä–∫", "–í–∫—É—Å–Ω–æ –∏ —Ç–æ—á–∫–∞", "–ö–∞–±–∞—Ä–¥–∏–Ω–∫–∞", "–†—ã–±–∏–Ω–∫–∞"
    ];

    let players = [];
    let playerNames = [];
    let currentPlayerIndex = 0;
    let spyMode = 'classic';

    function renderNameInputs() {
      const count = parseInt(document.getElementById('playerCount').value);
      const container = document.getElementById('nameFields');
      container.innerHTML = '';

      for (let i = 0; i < count; i++) {
        const input = document.createElement('input');
        input.type = 'text';
        input.placeholder = `–ò–º—è –∏–≥—Ä–æ–∫–∞ ${i + 1}`;
        input.id = `playerName${i}`;
        container.appendChild(input);
      }
    }

    function setSpyMode(mode) {
      spyMode = mode;
      document.querySelectorAll('.mode-button').forEach(btn => btn.classList.remove('active'));
      const buttons = document.getElementsByClassName('mode-button');
      if (mode === 'classic') buttons[0].classList.add('active');
      if (mode === 'random') buttons[1].classList.add('active');
      if (mode === 'custom') buttons[2].classList.add('active');

      document.getElementById('spyCountBlock').style.display = mode === 'custom' ? 'block' : 'none';
    }

    function startGame() {
      const count = parseInt(document.getElementById('playerCount').value);
      if (isNaN(count) || count < 3) {
        alert("–ú–∏–Ω–∏–º—É–º 3 –∏–≥—Ä–æ–∫–∞!");
        return;
      }

      let spyCount = 1;
      if (spyMode === 'custom') {
        spyCount = parseInt(document.getElementById('spyCount').value);
        if (isNaN(spyCount) || spyCount < 1 || spyCount >= count) {
          alert("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —à–ø–∏–æ–Ω–æ–≤ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ –º–µ–Ω—å—à–µ 1 –∏ –º–µ–Ω—å—à–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏–≥—Ä–æ–∫–æ–≤");
          return;
        }
      } else if (spyMode === 'random') {
        spyCount = Math.floor(Math.random() * (count - 1)) + 1;
      }

      const location = locations[Math.floor(Math.random() * locations.length)];
      players = [];
      playerNames = [];

      for (let i = 0; i < count; i++) {
        const nameInput = document.getElementById(`playerName${i}`);
        const name = nameInput?.value.trim() || `–ò–≥—Ä–æ–∫ ${i + 1}`;
        playerNames.push(name);
        players.push(location);
      }

      const spyIndices = [];
      while (spyIndices.length < spyCount) {
        const index = Math.floor(Math.random() * count);
        if (!spyIndices.includes(index)) {
          spyIndices.push(index);
          players[index] = "–®–ø–∏–æ–Ω";
        }
      }

      currentPlayerIndex = 0;
      showScreen("cardScreen");
      updatePlayerName();
    }

    function updatePlayerName() {
      document.getElementById('currentPlayer').textContent = `–•–æ–¥: ${playerNames[currentPlayerIndex]}`;
    }

    function showCard() {
      const card = players[currentPlayerIndex];
      const text = card === "–®–ø–∏–æ–Ω" ? "–¢—ã ‚Äî –®–ü–ò–û–ù üëÄ" : `–õ–æ–∫–∞—Ü–∏—è: ${card}`;
      document.getElementById('cardText').textContent = text;
      showScreen("showCardScreen");
    }

    function nextPlayer() {
      currentPlayerIndex++;
      if (currentPlayerIndex >= players.length) {
        showScreen("endScreen");
      } else {
        showScreen("cardScreen");
        updatePlayerName();
      }
    }

    function showScreen(id) {
      document.querySelectorAll(".screen").forEach(div => div.classList.remove("visible"));
      document.getElementById(id).classList.add("visible");
    }

    function showAllRoles() {
      const container = document.getElementById('allRoles');
      container.innerHTML = ''; // –æ—á–∏—Å—Ç–∫–∞

      const list = document.createElement('div');
      list.className = 'role-list';

      const title = document.createElement('h3');
      title.textContent = '–†–æ–ª–∏ –∏–≥—Ä–æ–∫–æ–≤:';
      list.appendChild(title);

      for (let i = 0; i < playerNames.length; i++) {
        const item = document.createElement('div');
        item.textContent = `${playerNames[i]} ‚Äî ${players[i]}`;
        list.appendChild(item);
      }

      container.appendChild(list);
    }

    document.addEventListener("DOMContentLoaded", () => {
      renderNameInputs();
      setSpyMode('classic');
    });
  </script>
</body>
</html>
