<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ò–≥—Ä—ã: –®–ø–∏–æ–Ω –∏ –ú–∞—Ñ–∏—è</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background-color: #f5f5f5;
      margin: 0;
      padding: 20px;
    }
    .screen { display: none; }
    .visible { display: block; }
    button {
      padding: 10px 20px;
      margin: 10px;
      font-size: 16px;
      cursor: pointer;
    }
    .card {
      font-size: 20px;
      margin: 30px 0;
      white-space: pre-wrap;
    }
    input[type="text"], input[type="number"] {
      margin: 5px;
      padding: 5px;
      font-size: 14px;
      width: 200px;
    }
    .mode-button {
      margin: 5px;
      padding: 8px 16px;
      font-size: 14px;
      cursor: pointer;
      border: 2px solid #333;
      background-color: white;
    }
    .mode-button.active {
      background-color: #333;
      color: white;
    }
    #spyCountBlock, #allRoles, #mafiaRoles {
      margin-top: 20px;
    }
    .role-list {
      text-align: left;
      display: inline-block;
    }
    .role-input {
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 4px 0;
    }
    .role-input label {
      width: 100px;
      text-align: right;
      margin-right: 10px;
    }
  </style>
</head>
<body>

<div id="mainMenu" class="screen visible">
  <h1>–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä—É</h1>
  <button onclick="selectGame('spy')">–ò–≥—Ä–∞—Ç—å –≤ –®–ø–∏–æ–Ω–∞</button>
  <button onclick="selectGame('mafia')">–ò–≥—Ä–∞—Ç—å –≤ –ú–∞—Ñ–∏—é</button>
</div>

<!-- –≠–∫—Ä–∞–Ω—ã –®–ü–ò–û–ù–ê -->
<div id="startScreen" class="screen">
  <h1>–ò–≥—Ä–∞ "–®–ø–∏–æ–Ω"</h1>
  <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤:
    <input type="number" id="playerCount" min="3" max="20" value="6" oninput="renderNameInputs()" />
  </label>
  <h3>–†–µ–∂–∏–º —à–ø–∏–æ–Ω–æ–≤:</h3>
  <div>
    <button class="mode-button" onclick="setSpyMode('classic')">–ö–ª–∞—Å—Å–∏–∫–∞ (1 —à–ø–∏–æ–Ω)</button>
    <button class="mode-button" onclick="setSpyMode('random')">–°–ª—É—á–∞–π–Ω–æ</button>
    <button class="mode-button" onclick="setSpyMode('custom')">–í—ã–±–æ—Ä –≤—Ä—É—á–Ω—É—é</button>
  </div>
  <div id="spyCountBlock" style="display:none;">
    <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —à–ø–∏–æ–Ω–æ–≤:
      <input type="number" id="spyCount" min="1" value="1" />
    </label>
  </div>
  <div id="nameFields"></div>
  <button onclick="startGame()">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
  <br><br>
  <button onclick="returnToMenu()">–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é</button>
</div>

<div id="cardScreen" class="screen">
  <h2><span id="currentPlayer"></span></h2>
  <button onclick="showCard()">–ü–æ–∫–∞–∑–∞—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É</button>
</div>

<div id="showCardScreen" class="screen">
  <div class="card" id="cardText">...</div>
  <button onclick="nextPlayer()">–Ø –ø–æ—Å–º–æ—Ç—Ä–µ–ª</button>
</div>

<div id="endScreen" class="screen">
  <h2>–í—Å–µ –∏–≥—Ä–æ–∫–∏ –ø–æ—Å–º–æ—Ç—Ä–µ–ª–∏ —Å–≤–æ–∏ –∫–∞—Ä—Ç–æ—á–∫–∏</h2>
  <button onclick="location.reload()">–°—ã–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
  <button onclick="showAllRoles()">–ü–æ–∫–∞–∑–∞—Ç—å —Ä–æ–ª–∏ –∏–≥—Ä–æ–∫–æ–≤</button>
  <div id="allRoles"></div>
</div>
<!-- –≠–∫—Ä–∞–Ω—ã –ú–ê–§–ò–ò -->
<div id="mafiaGameScreen" class="screen">
  <h1>–ò–≥—Ä–∞ "–ú–∞—Ñ–∏—è"</h1>
  <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤:
    <input type="number" id="mafiaPlayerCount" min="5" max="20" value="7" oninput="renderMafiaInputs()" />
  </label>
  <h3>–£–∫–∞–∂–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞–∂–¥–æ–π —Ä–æ–ª–∏:</h3>
  <div id="roleInputs"></div>
  <h3>–ò–º–µ–Ω–∞ –∏–≥—Ä–æ–∫–æ–≤:</h3>
  <div id="mafiaNameFields"></div>
  <button onclick="startMafiaGame()">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
  <br><br>
  <button onclick="returnToMenu()">–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é</button>
</div>

<div id="mafiaCardScreen" class="screen">
  <h2><span id="mafiaCurrentPlayer"></span></h2>
  <button onclick="showMafiaCard()">–ü–æ–∫–∞–∑–∞—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É</button>
</div>

<div id="mafiaShowCardScreen" class="screen">
  <div class="card" id="mafiaCardText">...</div>
  <button onclick="nextMafiaPlayer()">–Ø –ø–æ—Å–º–æ—Ç—Ä–µ–ª</button>
</div>

<div id="mafiaEndScreen" class="screen">
  <h2>–í—Å–µ –∏–≥—Ä–æ–∫–∏ –ø–æ–ª—É—á–∏–ª–∏ —Å–≤–æ–∏ —Ä–æ–ª–∏</h2>
  <button onclick="location.reload()">–°—ã–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
  <button onclick="showMafiaRoles()">–ü–æ–∫–∞–∑–∞—Ç—å —Ä–æ–ª–∏ –∏–≥—Ä–æ–∫–æ–≤</button>
  <div id="mafiaRoles"></div>
</div>

<script>
const locations = ["–õ–∞–±–∞ –≤–∫—É—Å–∞", "–•–∞—Ç–∞ –Ø—Ä–∏–∫–∞", "–ö–æ—Ä–≥–∏—à", "–î–∂–∞–æ –î–∞", "–¶–µ—Ä–∫–æ–≤—å", "–ü–æ–¥–∑–µ–ª–µ–Ω—å–µ", "–ö–∏–Ω–æ—Ç–µ–∞—Ç—Ä", "–®–∫–æ–ª–∞", "–ü–æ–µ–∑–¥", "–ê–ª–∫–æ–º–∞—Ä–∫–µ—Ç", "–ü–∞—Ä–∫", "–í–∫—É—Å–Ω–æ –∏ —Ç–æ—á–∫–∞", "–ö–∞–±–∞—Ä–¥–∏–Ω–∫–∞", "–†—ã–±–∏–Ω–∫–∞"];
const mafiaRoles = ["–ú–∏—Ä–Ω—ã–π", "–ú–∞—Ñ–∏—è", "–î–æ–Ω –º–∞—Ñ–∏–∏", "–ö–æ–º–∏—Å—Å–∞—Ä", "–î–æ–∫—Ç–æ—Ä", "–ü—É—Ç–∞–Ω–∞", "–ú–∞–Ω—å—è–∫"];
const mafiaRoleDescriptions = {
  "–ú–∏—Ä–Ω—ã–π": "–°–∞–º—ã–π –æ–±—ã—á–Ω—ã–π –∂–∏—Ç–µ–ª—å. –ù–µ –∏–º–µ–µ—Ç –Ω–æ—á–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π. –ì–ª–∞–≤–Ω–∞—è —Å–∏–ª–∞ ‚Äî –æ–±—Å—É–∂–¥–µ–Ω–∏–µ –∏ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ.",
  "–ú–∞—Ñ–∏—è": "–ü—Ä–æ—Å—ã–ø–∞–µ—Ç—Å—è –Ω–æ—á—å—é —Å –¥—Ä—É–≥–∏–º–∏ –º–∞—Ñ–∏–æ–∑–∏ –∏ –≤—ã–±–∏—Ä–∞–µ—Ç –∂–µ—Ä—Ç–≤—É. –£–±–∏–≤–∞–µ—Ç –æ–¥–Ω–æ–≥–æ –∏–≥—Ä–æ–∫–∞ –∑–∞ –Ω–æ—á—å.",
  "–î–æ–Ω –º–∞—Ñ–∏–∏": "–ì–ª–∞–≤–∞ –º–∞—Ñ–∏–∏. –ö—Ä–æ–º–µ —É–±–∏–π—Å—Ç–≤–∞ –º–æ–∂–µ—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∏–≥—Ä–æ–∫–æ–≤ ‚Äî –∏—â–µ—Ç –∫–æ–º–∏—Å—Å–∞—Ä–∞.",
  "–ö–æ–º–∏—Å—Å–∞—Ä": "–ö–∞–∂–¥—É—é –Ω–æ—á—å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –æ–¥–Ω–æ–≥–æ –∏–≥—Ä–æ–∫–∞ ‚Äî —É–∑–Ω–∞–µ—Ç, –º–∞—Ñ–∏—è –æ–Ω –∏–ª–∏ –Ω–µ—Ç. –ï—Å–ª–∏ –æ–Ω –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –º–∞–Ω—å—è–∫–∞, —Ç–æ –≤–µ–¥—É—â–∏–π –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–µ—Ç. –î–ª—è –∫–æ–º–∏—Å—Å–∞—Ä–∞ –º–∞–Ω—å—è–∫ —Å—á–∏—Ç–∞–µ—Ç—Å—è –∑–∞ –æ–±—ã—á–Ω–æ–≥–æ –∏–≥—Ä–æ–∫–∞",
  "–î–æ–∫—Ç–æ—Ä": "–ú–æ–∂–µ—Ç –≤—ã–ª–µ—á–∏—Ç—å –æ–¥–Ω–æ–≥–æ –∏–≥—Ä–æ–∫–∞ –æ—Ç –≤—ã—Å—Ç—Ä–µ–ª–∞ –º–∞—Ñ–∏–∏. –°–µ–±—è –ª–µ—á–∏—Ç —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑ –∑–∞ –∏–≥—Ä—É. –ù–µ–ª—å–∑—è –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ –æ–¥–Ω–æ–≥–æ –∏–≥—Ä–æ–∫–∞ 2 —Ö–æ–¥–∞ –ø–æ–¥—Ä—è–¥.",
  "–ü—É—Ç–∞–Ω–∞": "–ë–ª–æ–∫–∏—Ä—É–µ—Ç –¥–µ–π—Å—Ç–≤–∏—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∏–≥—Ä–æ–∫–∞ –Ω–æ—á—å—é. –ù–µ –º–æ–∂–µ—Ç –≤—ã–±–∏—Ä–∞—Ç—å –æ–¥–Ω–æ–≥–æ –∏ —Ç–æ–≥–æ –∂–µ 2 –Ω–æ—á–∏ –ø–æ–¥—Ä—è–¥.",
  "–ú–∞–Ω—å—è–∫": "–£–±–∏–≤–∞–µ—Ç –ø–æ –æ–¥–Ω–æ–º—É –∏–≥—Ä–æ–∫—É –∑–∞ –Ω–æ—á—å. –ò–≥—Ä–∞–µ—Ç —Å–∞–º –∑–∞ —Å–µ–±—è. –ú–æ–∂–µ—Ç –æ—Ç–∫–∞–∑–∞—Ç—å—Å—è –æ—Ç —É–±–∏–π—Å—Ç–≤–∞."
};
let players = [], playerNames = [], currentPlayerIndex = 0, spyMode = 'classic';
let mafiaPlayers = [], mafiaPlayerNames = [], mafiaCurrentPlayerIndex = 0, selectedRoles = [];

function showScreen(id) {
  document.querySelectorAll(".screen").forEach(div => div.classList.remove("visible"));
  document.getElementById(id).classList.add("visible");
}
function selectGame(game) {
  if (game === 'spy') showScreen('startScreen');
  else if (game === 'mafia') showScreen('mafiaGameScreen');
}
function returnToMenu() { showScreen('mainMenu'); }

// ---------- –®–ü–ò–û–ù ----------
function renderNameInputs() {
  const count = parseInt(document.getElementById('playerCount').value);
  const container = document.getElementById('nameFields');
  container.innerHTML = '';
  for (let i = 0; i < count; i++) {
    const input = document.createElement('input');
    input.type = 'text';
    input.placeholder = `–ò–º—è –∏–≥—Ä–æ–∫–∞ ${i + 1}`;
    input.id = `playerName${i}`;
    container.appendChild(input);
  }
}
function setSpyMode(mode) {
  spyMode = mode;
  document.querySelectorAll('.mode-button').forEach(btn => btn.classList.remove('active'));
  document.querySelectorAll('.mode-button')[mode === 'classic' ? 0 : mode === 'random' ? 1 : 2].classList.add('active');
  document.getElementById('spyCountBlock').style.display = mode === 'custom' ? 'block' : 'none';
}
function startGame() {
  const count = parseInt(document.getElementById('playerCount').value);
  if (isNaN(count) || count < 3) return alert("–ú–∏–Ω–∏–º—É–º 3 –∏–≥—Ä–æ–∫–∞!");
  let spyCount = spyMode === 'random' ? Math.floor(Math.random() * (count - 1)) + 1 :
                 spyMode === 'custom' ? parseInt(document.getElementById('spyCount').value) : 1;
  if (spyMode === 'custom' && (isNaN(spyCount) || spyCount < 1 || spyCount >= count)) return alert("–ù–µ–≤–µ—Ä–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —à–ø–∏–æ–Ω–æ–≤!");
  const location = locations[Math.floor(Math.random() * locations.length)];
  players = [], playerNames = [];
  for (let i = 0; i < count; i++) {
    const name = document.getElementById(`playerName${i}`)?.value.trim() || `–ò–≥—Ä–æ–∫ ${i + 1}`;
    playerNames.push(name);
    players.push(location);
  }
  const spyIndices = [];
  while (spyIndices.length < spyCount) {
    const index = Math.floor(Math.random() * count);
    if (!spyIndices.includes(index)) {
      spyIndices.push(index);
      players[index] = "–®–ø–∏–æ–Ω";
    }
  }
  currentPlayerIndex = 0;
  showScreen("cardScreen");
  updatePlayerName();
}
function updatePlayerName() {
  document.getElementById('currentPlayer').textContent = `–•–æ–¥: ${playerNames[currentPlayerIndex]}`;
}
function showCard() {
  const card = players[currentPlayerIndex];
  document.getElementById('cardText').textContent = card === "–®–ø–∏–æ–Ω" ? "–¢—ã ‚Äî –®–ü–ò–û–ù üëÄ" : `–õ–æ–∫–∞—Ü–∏—è: ${card}`;
  showScreen("showCardScreen");
}
function nextPlayer() {
  currentPlayerIndex++;
  if (currentPlayerIndex >= players.length) showScreen("endScreen");
  else {
    showScreen("cardScreen");
    updatePlayerName();
  }
}
function showAllRoles() {
  const container = document.getElementById('allRoles');
  container.innerHTML = '';
  const list = document.createElement('div');
  list.className = 'role-list';
  list.innerHTML = '<h3>–†–æ–ª–∏ –∏–≥—Ä–æ–∫–æ–≤:</h3>';
  playerNames.forEach((name, i) => {
    const item = document.createElement('div');
    item.textContent = `${name} ‚Äî ${players[i]}`;
    list.appendChild(item);
  });
  container.appendChild(list);
}

// ---------- –ú–ê–§–ò–Ø ----------
function renderMafiaInputs() {
  const count = parseInt(document.getElementById('mafiaPlayerCount').value);
  renderRoleInputs();
  renderMafiaNameInputs(count);
}
function renderRoleInputs() {
  const container = document.getElementById('roleInputs');
  container.innerHTML = '';
  mafiaRoles.forEach(role => {
    const div = document.createElement('div');
    div.className = 'role-input';
    const label = document.createElement('label');
    label.textContent = role;
    const input = document.createElement('input');
    input.type = 'number';
    input.min = '0';
    input.value = '0';
    input.id = `count-${role}`;
    div.appendChild(label);
    div.appendChild(input);
    container.appendChild(div);
  });
}
function renderMafiaNameInputs(count) {
  const container = document.getElementById('mafiaNameFields');
  container.innerHTML = '';
  for (let i = 0; i < count; i++) {
    const input = document.createElement('input');
    input.type = 'text';
    input.placeholder = `–ò–º—è –∏–≥—Ä–æ–∫–∞ ${i + 1}`;
    input.id = `mafiaPlayerName${i}`;
    container.appendChild(input);
  }
}
function startMafiaGame() {
  const count = parseInt(document.getElementById('mafiaPlayerCount').value);
  if (isNaN(count) || count < 5) return alert("–ú–∏–Ω–∏–º—É–º 5 –∏–≥—Ä–æ–∫–æ–≤!");
  selectedRoles = [];
  let totalSelected = 0;
  mafiaRoles.forEach(role => {
    const qty = parseInt(document.getElementById(`count-${role}`).value);
    if (!isNaN(qty) && qty > 0) {
      for (let i = 0; i < qty; i++) selectedRoles.push(role);
      totalSelected += qty;
    }
  });
  if (totalSelected !== count) return alert(`–°—É–º–º–∞ —Ä–æ–ª–µ–π (${totalSelected}) ‚â† –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∏–≥—Ä–æ–∫–æ–≤ (${count})`);
  mafiaPlayers = selectedRoles.sort(() => Math.random() - 0.5);
  mafiaPlayerNames = [];
  for (let i = 0; i < count; i++) {
    const name = document.getElementById(`mafiaPlayerName${i}`)?.value.trim() || `–ò–≥—Ä–æ–∫ ${i + 1}`;
    mafiaPlayerNames.push(name);
  }
  mafiaCurrentPlayerIndex = 0;
  showScreen("mafiaCardScreen");
  updateMafiaPlayerName();
}
function updateMafiaPlayerName() {
  document.getElementById('mafiaCurrentPlayer').textContent = `–•–æ–¥: ${mafiaPlayerNames[mafiaCurrentPlayerIndex]}`;
}
function showMafiaCard() {
  const role = mafiaPlayers[mafiaCurrentPlayerIndex];
  const description = mafiaRoleDescriptions[role] || "–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.";
  document.getElementById('mafiaCardText').innerHTML = `<strong>–¢–≤–æ—è —Ä–æ–ª—å:</strong> ${role}<br><br><small>${description.replace(/\\n/g, "<br>")}</small>`;
  showScreen("mafiaShowCardScreen");
}
function nextMafiaPlayer() {
  mafiaCurrentPlayerIndex++;
  if (mafiaCurrentPlayerIndex >= mafiaPlayers.length) showScreen("mafiaEndScreen");
  else {
    showScreen("mafiaCardScreen");
    updateMafiaPlayerName();
  }
}
function showMafiaRoles() {
  const container = document.getElementById('mafiaRoles');
  container.innerHTML = '';
  const list = document.createElement('div');
  list.className = 'role-list';
  list.innerHTML = '<h3>–†–æ–ª–∏ –∏–≥—Ä–æ–∫–æ–≤:</h3>';
  mafiaPlayerNames.forEach((name, i) => {
    const item = document.createElement('div');
    item.textContent = `${name} ‚Äî ${mafiaPlayers[i]}`;
    list.appendChild(item);
  });
  container.appendChild(list);
}

document.addEventListener("DOMContentLoaded", () => {
  renderNameInputs();
  renderMafiaInputs();
  setSpyMode('classic');
});
</script>
</body>
</html>
